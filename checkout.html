<!doctype html>
<html lang="en">
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:300,400,500,600,700&display=swap" rel="stylesheet">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Niyantran - Checkout</title>
  <!--  -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body style="font-family: 'Inter', sans-serif;" class="bg-gray-50 text-gray-900">
  <header class="w-full bg-white shadow">
    <nav class="max-w-screen-xl mx-auto px-4 py-4 flex items-center justify-between">
      <a href="./index.html" class="text-xl font-semibold">Niyantran</a>
      <div class="flex items-center space-x-6 text-sm">
        <a href="./index.html" class="hover:underline">Home</a>
        <a href="./menu.html" class="hover:underline">Menu</a>
        <a href="./about.html" class="hover:underline">About</a>
        <a href="./cart.html" class="hover:underline">Cart</a>
        <a href="./checkout.html" class="hover:underline">Checkout</a>
        <a href="./contact.html" class="hover:underline">Contact</a>
      </div>
    </nav>
  </header>

  <main class="w-full py-8 px-6">
    <section class="max-w-3xl mx-auto bg-white rounded-lg shadow p-6">
      <h2 class="text-2xl font-semibold mb-4">Checkout</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm mb-1">Full Name</label>
          <input id="name" type="text" class="w-full border rounded px-3 py-2" placeholder="Your name" />
        </div>
        <div>
          <label class="block text-sm mb-1">Email</label>
          <input id="email" type="email" class="w-full border rounded px-3 py-2" placeholder="you@example.com" />
        </div>
        <div class="md:col-span-2">
          <label class="block text-sm mb-1">Address</label>
          <input id="address" type="text" class="w-full border rounded px-3 py-2" placeholder="123 Coffee Lane" />
        </div>
      </div>
      <hr class="my-4" />
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-end">
        <div>
          <label class="block text-sm mb-1">Card Number</label>
          <input id="card-number" type="text" class="w-full border rounded px-3 py-2" placeholder="4242 4242 4242 4242" />
        </div>
        <div>
          <label class="block text-sm mb-1">Expiry</label>
          <input id="card-exp" type="text" class="w-full border rounded px-3 py-2" placeholder="MM/YY" />
        </div>
        <div>
          <label class="block text-sm mb-1">CVC</label>
          <input id="card-cvc" type="text" class="w-full border rounded px-3 py-2" placeholder="123" />
        </div>
      </div>
      <div class="mt-4 flex items-center justify-between">
        <span class="text-lg font-semibold">Total: $<span id="checkout-total">0.00</span></span>
        <button id="pay-now" class="bg-primary text-white px-6 py-3 rounded">Pay with Mock Stripe</button>
      </div>
      <p id="status" class="mt-4 text-sm text-green-700 hidden">Payment succeeded! Thank you for your order.</p>
    </section>
  </main>

  <footer class="w-full bg-gray-800 text-white py-6 mt-8">
    <div class="max-w-screen-xl mx-auto px-4 text-sm">Â© <span id="year5"></span> Niyantran. All rights reserved.</div>
  </footer>

  <script>
    // Calculate total from cart
    function getCartTotal(){ const cart = JSON.parse(localStorage.getItem('ny_cart') || '{}'); let total = 0; Object.values(cart).forEach(i => total += (i.qty || 0) * (i.price || 0)); return total; }
    document.getElementById('checkout-total').textContent = Number(getCartTotal().toFixed(2)).toFixed(2);
    document.getElementById('year5').textContent = new Date().getFullYear();

    async function mockCreatePaymentIntent(amount){
      // Call mock backend to get a clientSecret (mock)
      try {
        const resp = await fetch('/mock/payment-intent', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ amount, currency: 'usd' })
        });
        return resp.json();
      } catch (e) {
        // Fallback dummy clientSecret if mock API fails
        return { clientSecret: 'pi_mock_secret_dummy' };
      }
    }

    document.getElementById('pay-now').addEventListener('click', async () => {
      const name = document.getElementById('name').value || '';
      const email = document.getElementById('email').value || '';
      const address = document.getElementById('address').value || '';

      // Simple validation (mock)
      if(!name || !email){ alert('Please enter name and email.'); return; }

      const amount = Math.round(getCartTotal() * 100); // cents
      const { clientSecret } = await mockCreatePaymentIntent(amount);

      // Mock Stripe flow: we simulate payment using the mock backend response
      // In a real app, you would use Stripe.js to confirm card payment with the clientSecret
      // This is a development mock to demonstrate flow without real charges.
      await new Promise(r => setTimeout(r, 800));
      document.getElementById('status').classList.remove('hidden');
      document.getElementById('status').textContent = 'Payment succeeded! Thank you, ' + name + ' (mock).';
    });
  </script>
  
</body>
</html>